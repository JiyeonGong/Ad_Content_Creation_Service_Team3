# model_config.yaml
# 이미지 생성 모델 설정 파일
# 새 모델 추가 시 이 파일만 수정하면 됨

models:
  # FLUX 모델 (최신, 고품질, 한국어 지원 우수)
  flux-schnell:
    id: "black-forest-labs/FLUX.1-schnell"
    type: "flux"
    requires_auth: true
    params:
      default_steps: 4
      max_steps: 8
      use_negative_prompt: false
      guidance_scale: null
      supports_i2i: true
      max_tokens: 512
      default_size: [1024, 1024]
      max_size: [2048, 2048]
    description: "빠른 생성, 4 steps 권장"
    
  flux-dev:
    id: "black-forest-labs/FLUX.1-dev"
    type: "flux"
    requires_auth: true
    params:
      default_steps: 28
      max_steps: 50
      use_negative_prompt: false
      guidance_scale: 3.5
      supports_i2i: true
      max_tokens: 512
      default_size: [1024, 1024]
      max_size: [2048, 2048]
    description: "고품질, 느림"

  # GCP VM 전용 flux-dev (로컬 경로)
  flux-dev-gcp:
    id: "/home/shared/FLUX.1-dev"  # GCP VM 로컬 경로
    type: "flux"
    requires_auth: false  # 이미 다운로드됨
    params:
      default_steps: 28
      max_steps: 50
      use_negative_prompt: false
      guidance_scale: 3.5
      supports_i2i: true
      max_tokens: 512
      default_size: [1024, 1024]
      max_size: [2048, 2048]
    description: "GCP VM용 FLUX.1-dev (로컬)"
  
  # Stable Diffusion XL (안정적, 폴백용)
  sdxl:
    id: "stabilityai/stable-diffusion-xl-base-1.0"
    type: "sdxl"
    requires_auth: false
    params:
      default_steps: 30
      max_steps: 50
      use_negative_prompt: true
      guidance_scale: 7.5
      supports_i2i: true
      max_tokens: 77
      default_size: [1024, 1024]
      max_size: [2048, 2048]
      negative_prompt: "low quality, blurry, text, watermark, distorted, ugly, tiling"
    description: "안정적, 무료"
  
  # Stable Diffusion 3
  sd3:
    id: "stabilityai/stable-diffusion-3-medium-diffusers"
    type: "sd3"
    requires_auth: true
    params:
      default_steps: 28
      max_steps: 50
      use_negative_prompt: true
      guidance_scale: 7.0
      supports_i2i: true
      max_tokens: 77
      default_size: [1024, 1024]
      max_size: [2048, 2048]
      negative_prompt: "low quality, blurry, distorted"
    description: "SD3, 텍스트 렌더링 개선"
  
  # Kandinsky 3 (다국어 지원)
  kandinsky:
    id: "kandinsky-community/kandinsky-3"
    type: "kandinsky"
    requires_auth: false
    params:
      default_steps: 25
      max_steps: 50
      use_negative_prompt: true
      guidance_scale: 7.0
      supports_i2i: true
      max_tokens: 77
      default_size: [1024, 1024]
      max_size: [1536, 1536]
      negative_prompt: "low quality, blurry"
    description: "러시아 모델, 다국어"
  
  # Playground v2.5
  playground:
    id: "playgroundai/playground-v2.5-1024px-aesthetic"
    type: "sdxl"
    requires_auth: false
    params:
      default_steps: 25
      max_steps: 50
      use_negative_prompt: false
      guidance_scale: 3.0
      supports_i2i: true
      max_tokens: 77
      default_size: [1024, 1024]
      max_size: [1536, 1536]
    description: "미적 품질 최적화"

# 실행 설정
runtime:
  # 기본 사용 모델 (환경변수로 오버라이드 가능)
  primary_model: "flux-dev-gcp"

  
  # 폴백 모델 체인 (순서대로 시도)
  fallback_models:
    - "flux-schnell"
    - "playground"
  
  # 폴백 활성화 여부
  enable_fallback: true
  
  # 프롬프트 최적화 설정
  prompt_optimization:
    enabled: true
    translate_korean: true
    max_length_by_model: true  # 모델별 토큰 제한 준수
  
  # 메모리 최적화 및 속도 개선
  memory:
    # 양자화 설정 (FLUX 전용, 22GB → 12GB 압축)
    # 옵션: "fp8" (품질 우선, 2-2.6배), "nf4" (속도 우선, 3-4배), "none" (양자화 안 함)
    quantization_type: "fp8"  # 기본값: FP8 (품질 99%+, 속도 2-2.6배)

    # CPU offload (양자화 사용 시 자동 비활성화됨)
    enable_cpu_offload: true  # 양자화 미사용 시에만 적용

    # Attention 최적화 (양자화와 함께 사용 시 추가 속도 개선)
    use_flash_attention: true  # Flash Attention 2 (1.5-2배 속도 개선)
    enable_attention_slicing: true  # 추가 메모리 절약

    # VAE 최적화
    enable_vae_slicing: true  # VAE 슬라이싱

    # 기타 (deprecated)
    use_8bit: false  # 사용 안 함 (quantization_type 사용)