# ============================================================

# í™ë³´ ë¬¸êµ¬/í•´ì‹œíƒœê·¸ ìƒì„± gpt-4o-mini 

# ============================================================



import streamlit as st

import os

from dotenv import load_dotenv

from openai import OpenAI



# ============================================================

# ğŸŒ í™˜ê²½ ì„¤ì •

# ============================================================

load_dotenv()

OPENAI_API_KEY = os.getenv("OPENAI_API_KEY")



if OPENAI_API_KEY:

    try:

        client = OpenAI(api_key=OPENAI_API_KEY)

        model_name = "gpt-4o-mini"  

    except Exception as e:

        st.error(f"OpenAI í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì˜¤ë¥˜: {e}")

        client = None

else:

    st.warning("âš ï¸ OPENAI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. .env íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")

    client = None

    model_name = ""



# ============================================================

# ğŸ–¥ í˜ì´ì§€ ì„¤ì •

# ============================================================

st.set_page_config(page_title="ğŸ’ª í—¬ìŠ¤ì¼€ì–´ AI ì½˜í…ì¸  ì œì‘", layout="wide")

st.sidebar.title("ë©”ë‰´")

menu = st.sidebar.radio(

    "í˜ì´ì§€ ì„ íƒ",

    ["ğŸ“ í™ë³´ ë¬¸êµ¬/í•´ì‹œíƒœê·¸ ìƒì„±", "ğŸ–¼ ì´ë¯¸ì§€ ìƒì„±(ì¤€ë¹„ ì¤‘)"],

)



# ============================================================

# ğŸ§© ìœ í‹¸ í•¨ìˆ˜

# ============================================================

def validate_inputs(service_name, features):

    """í•„ìˆ˜ ì…ë ¥ ê²€ì¦"""

    if not service_name or not features:

        st.warning("âš ï¸ ì„œë¹„ìŠ¤ ì´ë¦„ê³¼ í•µì‹¬ íŠ¹ì§•ì€ ë°˜ë“œì‹œ ì…ë ¥í•´ì£¼ì„¸ìš”.")

        return False

    return True





def generate_caption(client, model, tone, info):

    """ì¸ìŠ¤íƒ€ê·¸ë¨ ë¬¸êµ¬ ìƒì„±"""

    prompt = f"""

ë‹¹ì‹ ì€ í—¬ìŠ¤ì¼€ì–´ ì†Œìƒê³µì¸ì„ ìœ„í•œ ì „ë¬¸ ì¸ìŠ¤íƒ€ê·¸ë¨ ì¹´í”¼ë¼ì´í„°ì…ë‹ˆë‹¤.

ì•„ë˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ **ì¸ìŠ¤íƒ€ê·¸ë¨ ê²Œì‹œë¬¼ì— ìµœì í™”ëœ** í™ë³´ ë¬¸êµ¬ 3ê°œë¥¼ ì‘ì„±í•˜ì„¸ìš”.



â€» í•„ìˆ˜ ê·œì¹™

1. **ì˜ë£Œ/ì‹í’ˆ í—ˆìœ„Â·ê³¼ì¥ í‘œí˜„** (ì˜ˆ: 100% íš¨ê³¼ ë³´ì¥, ì¦‰ì‹œ ì¹˜ë£Œ, ì™„ë²½í•œ ì¹˜ìœ )ì€ ì ˆëŒ€ ê¸ˆì§€í•©ë‹ˆë‹¤.

2. ê° ë¬¸êµ¬ëŠ” **ì²« ì¤„ í›„í‚¹ â†’ í•µì‹¬ ë©”ì‹œì§€ â†’ ëª…í™•í•œ CTA** êµ¬ì¡°ë¥¼ ìœ ì§€í•˜ì„¸ìš”.

3. ì´ëª¨í‹°ì½˜ì„ ì ì ˆíˆ ì‚¬ìš©í•´ **ê°€ë…ì„±**ê³¼ **ì¹œê·¼í•¨**ì„ ë†’ì´ì„¸ìš”.

4. ë¬¸ì²´ ìŠ¤íƒ€ì¼: {tone}



[ìŠ¤íƒ€ì¼ ì˜ˆì‹œ]

ì¹œê·¼í•˜ê³  ë™ê¸°ë¶€ì—¬: "ğŸ”¥ ì˜¤ëŠ˜ë¶€í„° ì§„ì§œ ëª¸ ë§Œë“¤ê¸° ì‹œì‘!"

ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê°: "ì²´ê³„ì ì¸ ë¶„ì„ê³¼ ê³¼í•™ì  ìš´ë™ë²•ìœ¼ë¡œ ëª¸ì„ ì„¤ê³„í•©ë‹ˆë‹¤."

ì¬ë¯¸ìˆê³  íŠ¸ë Œë””: "ìš´ë™ì€ ì§€ë£¨í•˜ë‹¤ëŠ” í¸ê²¬? ìš°ë¦¬ë‘ í•˜ë©´ NO!"

ì°¨ë¶„í•˜ê³  ê°ì„±ì : "ëª¸ê³¼ ë§ˆìŒì´ í•¨ê»˜ íšŒë³µë˜ëŠ” ì‹œê°„."



[ì •ë³´]

ì„œë¹„ìŠ¤ ì¢…ë¥˜: {info['service_type']}

ì„œë¹„ìŠ¤ëª…: {info['service_name']}

í•µì‹¬ íŠ¹ì§•: {info['features']}

ì§€ì—­: {info['location']}

ì´ë²¤íŠ¸: {info['event_info']}



---

# 1. ë¬¸êµ¬

[ì—¬ê¸°ì— ë¬¸êµ¬ ì‘ì„±]

# 2. ë¬¸êµ¬

[ì—¬ê¸°ì— ë¬¸êµ¬ ì‘ì„±]

# 3. ë¬¸êµ¬

[ì—¬ê¸°ì— ë¬¸êµ¬ ì‘ì„±]

---

"""

    response = client.chat.completions.create(

        model=model,

        messages=[{"role": "user", "content": prompt}],

        temperature=0.85,

        max_tokens=400,

    )

    return response.choices[0].message.content.strip()





def generate_hashtags(client, model, info, count):

    """ì¸ìŠ¤íƒ€ê·¸ë¨ í•´ì‹œíƒœê·¸ ìƒì„±"""

    prompt = f"""

ë‹¹ì‹ ì€ í—¬ìŠ¤ì¼€ì–´ SNS ë§ˆì¼€íŒ… ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

ì¸ìŠ¤íƒ€ê·¸ë¨ ë…¸ì¶œì„ ìœ„í•œ ìµœì ì˜ í•´ì‹œíƒœê·¸ {count}ê°œë¥¼ ìƒì„±í•˜ì„¸ìš”.



ê·œì¹™:

1. **ëŒ€í˜• íƒœê·¸ + ì¤‘í˜• íƒœê·¸ + ì§€ì—­/í‹ˆìƒˆ íƒœê·¸**ë¥¼ ê· í˜• ìˆê²Œ ì¡°í•©í•©ë‹ˆë‹¤.

2. ëª¨ë“  íƒœê·¸ëŠ” **#íƒœê·¸** í˜•ì‹ìœ¼ë¡œ ê³µë°± ì—†ì´ í•œ ì¤„ë¡œ ë‚˜ì—´í•©ë‹ˆë‹¤.

3. ì¤‘ë³µ íƒœê·¸ëŠ” ì œê±°í•˜ì„¸ìš”.

4. ê²°ê³¼ë§Œ ì¶œë ¥í•˜ì„¸ìš”.



[ì…ë ¥ ì •ë³´]

ì„œë¹„ìŠ¤ ì¢…ë¥˜: {info['service_type']}

ì„œë¹„ìŠ¤/ì œí’ˆëª…: {info['service_name']}

í•µì‹¬ íŠ¹ì§•: {info['features']}

ì§€ì—­: {info['location']}

"""

    response = client.chat.completions.create(

        model=model,

        messages=[{"role": "user", "content": prompt}],

        temperature=0.7,

        max_tokens=200,

    )

    return response.choices[0].message.content.strip()





# ============================================================

# ğŸ“£ í˜ì´ì§€ 1: í™ë³´ ë¬¸êµ¬/í•´ì‹œíƒœê·¸ ìƒì„±

# ============================================================

if menu == "ğŸ“ í™ë³´ ë¬¸êµ¬/í•´ì‹œíƒœê·¸ ìƒì„±":

    st.title("ğŸ“ ì¸ìŠ¤íƒ€ê·¸ë¨ ë§ì¶¤ í™ë³´ ë¬¸êµ¬ & í•´ì‹œíƒœê·¸ ìƒì„±")

    st.markdown("í—¬ìŠ¤ì¼€ì–´ ì†Œìƒê³µì¸ì„ ìœ„í•œ ìë™ ì½˜í…ì¸  ìƒì„± ë„ìš°ë¯¸ì…ë‹ˆë‹¤ ğŸ’ª")

    st.divider()



    # -------------------------

    # ğŸ“‹ ì…ë ¥ ì˜ì—­

    # -------------------------

    st.subheader("ğŸ’¡ ì„œë¹„ìŠ¤ ì •ë³´ ì…ë ¥")



    col1, col2 = st.columns(2)

    with col1:

        service_type = st.selectbox(

            "ì„œë¹„ìŠ¤ ì¢…ë¥˜",

            ["í—¬ìŠ¤ì¥", "PT (ê°œì¸ íŠ¸ë ˆì´ë‹)", "ìš”ê°€/í•„ë¼í…ŒìŠ¤", "ê±´ê°• ì‹í’ˆ/ë³´ì¡°ì œ", "ê¸°íƒ€"],

        )

    with col2:

        location = st.text_input("ì§€ì—­ (ì˜ˆ: ê°•ë‚¨, ë§ˆí¬êµ¬, ì˜¨ë¼ì¸)")



    service_name = st.text_input("ì œí’ˆ/í´ë˜ìŠ¤ ì´ë¦„ (ì˜ˆ: ì—¬ë¦„ íŠ¹ê°€ PT 8ì£¼ í”„ë¡œê·¸ë¨)")

    features = st.text_area(

        "í•µì‹¬ íŠ¹ì§• ë° ì¥ì  (ì¤„ë°”ê¿ˆ ë˜ëŠ” ì½¤ë§ˆë¡œ êµ¬ë¶„)",

        height=100,

        placeholder="ì˜ˆ: ìµœì‹  ë¨¸ì‹  ì™„ë¹„, 1:1 ë§ì¶¤ ì‹ë‹¨ ê´€ë¦¬, 20ë…„ ê²½ë ¥ íŠ¸ë ˆì´ë„ˆ",

    )



    col3, col4 = st.columns(2)

    with col3:

        event_info = st.text_input("ì´ë²¤íŠ¸/í• ì¸ ë‚´ìš© (ì„ íƒ)", placeholder="ì˜ˆ: ì„ ì°©ìˆœ 10ëª… 30% í• ì¸")

    with col4:

        tone = st.selectbox(

            "í†¤ ì„ íƒ",

            ["ì¹œê·¼í•˜ê³  ë™ê¸°ë¶€ì—¬", "ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê°", "ì¬ë¯¸ìˆê³  íŠ¸ë Œë””", "ì°¨ë¶„í•˜ê³  ê°ì„±ì "],

        )



    # í†¤ ì˜ˆì‹œ ë¯¸ë¦¬ë³´ê¸°

    tone_examples = {

        "ì¹œê·¼í•˜ê³  ë™ê¸°ë¶€ì—¬": "ğŸ”¥ ì˜¤ëŠ˜ë¶€í„° ì§„ì§œ ëª¸ ë§Œë“¤ê¸° ì‹œì‘!",

        "ì „ë¬¸ì ì´ê³  ì‹ ë¢°ê°": "ì²´ê³„ì ì¸ ë¶„ì„ê³¼ ê³¼í•™ì  ìš´ë™ë²•ìœ¼ë¡œ ëª¸ì„ ì„¤ê³„í•©ë‹ˆë‹¤.",

        "ì¬ë¯¸ìˆê³  íŠ¸ë Œë””": "ìš´ë™ì€ ì§€ë£¨í•˜ë‹¤ëŠ” í¸ê²¬? ìš°ë¦¬ë‘ í•˜ë©´ NO!",

        "ì°¨ë¶„í•˜ê³  ê°ì„±ì ": "ëª¸ê³¼ ë§ˆìŒì´ í•¨ê»˜ íšŒë³µë˜ëŠ” ì‹œê°„.",

    }

    st.caption(f"ğŸ’¬ í†¤ ì˜ˆì‹œ: {tone_examples[tone]}")



    st.divider()



    # ì˜ˆì‹œ ë³´ê¸° ë²„íŠ¼

    if st.button("ğŸ’¡ ì…ë ¥ ì˜ˆì‹œ ë³´ê¸°"):

        st.info(

            """

ì˜ˆì‹œ:

- ì„œë¹„ìŠ¤ ì¢…ë¥˜: PT (ê°œì¸ íŠ¸ë ˆì´ë‹)

- ì œí’ˆ/í´ë˜ìŠ¤ ì´ë¦„: ì—¬ë¦„ í•œì • 8ì£¼ ë°”ë”” ì±Œë¦°ì§€

- í•µì‹¬ íŠ¹ì§•: 1:1 ì²´í˜• ë¶„ì„, ì‹ë‹¨ í”¼ë“œë°±, í”„ë¦¬ë¯¸ì—„ ë¨¸ì‹  ì™„ë¹„

- ì´ë²¤íŠ¸: ì„ ì°©ìˆœ 10ëª… 30% í• ì¸

- ì§€ì—­: ê°•ë‚¨

"""

        )



    st.divider()



    # =======================================================

    # âœ… ë¬¸êµ¬ ìƒì„±

    # =======================================================

    if client:

        st.subheader("ğŸ“£ ì¸ìŠ¤íƒ€ê·¸ë¨ ë¬¸êµ¬ ìƒì„±")

        if st.button("âœ¨ ë¬¸êµ¬ 3ê°œ ìƒì„±í•˜ê¸°", type="primary"):

            if validate_inputs(service_name, features):

                with st.spinner("ë¬¸êµ¬ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤..."):

                    info = {

                        "service_type": service_type,

                        "service_name": service_name,

                        "features": features,

                        "location": location if location else "ì „êµ­/ì˜¨ë¼ì¸",

                        "event_info": event_info if event_info else "ì—†ìŒ",

                    }

                    ad_text = generate_caption(client, model_name, tone, info)



                    # ê²°ê³¼ ì¶œë ¥ (ì¹´ë“œ í˜•ì‹)

                    st.success("âœ… ë¬¸êµ¬ ìƒì„± ì™„ë£Œ!")

                    st.markdown("ì•„ë˜ ë¬¸êµ¬ë¥¼ ë³µì‚¬í•˜ì—¬ ì¸ìŠ¤íƒ€ê·¸ë¨ì— ë°”ë¡œ í™œìš©í•˜ì„¸ìš”.")

                    texts = ad_text.split("#")[1:]

                    for t in texts:

                        st.markdown(f"ğŸ’¬ **{t.strip()}**")

                        st.divider()



    else:

        st.error("âŒ API í´ë¼ì´ì–¸íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")



    # =======================================================

    # âœ… í•´ì‹œíƒœê·¸ ìƒì„±

    # =======================================================

    st.subheader("ğŸ”– ì¸ìŠ¤íƒ€ê·¸ë¨ í•´ì‹œíƒœê·¸ ìƒì„±")

    hashtag_count = st.slider("í•´ì‹œíƒœê·¸ ê°œìˆ˜ (ìµœëŒ€ 20ê°œ)", 5, 20, 15)

    if client and st.button("ğŸ”¥ í•´ì‹œíƒœê·¸ ìƒì„±í•˜ê¸°"):

        if validate_inputs(service_name, features):

            with st.spinner("í•´ì‹œíƒœê·¸ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤..."):

                info = {

                    "service_type": service_type,

                    "service_name": service_name,

                    "features": features,

                    "location": location if location else "ì „êµ­/ì˜¨ë¼ì¸",

                    "event_info": event_info if event_info else "ì—†ìŒ",

                }

                hashtags = generate_hashtags(client, model_name, info, hashtag_count)

                st.success("âœ… í•´ì‹œíƒœê·¸ ìƒì„± ì™„ë£Œ!")

                st.code(hashtags, language="text")

                st.caption("ë³µì‚¬í•˜ì—¬ ì¸ìŠ¤íƒ€ê·¸ë¨ ìº¡ì…˜ í•˜ë‹¨ ë˜ëŠ” ëŒ“ê¸€ì— í™œìš©í•˜ì„¸ìš”.")





# ============================================================

# âœ… í˜ì´ì§€ 2: ì´ë¯¸ì§€ ìƒì„± (ê°€ì œ)

# ============================================================

elif menu == "ğŸ–¼ ì´ë¯¸ì§€ ìƒì„±(ì¤€ë¹„ ì¤‘)":

    st.title("ğŸ–¼ ì¸ìŠ¤íƒ€ê·¸ë¨ ì´ë¯¸ì§€/ë°°ë„ˆ ìƒì„± (ì¤€ë¹„ ì¤‘)")

    st.markdown("---")

    st.info("ì´ í˜ì´ì§€ëŠ” í–¥í›„ DALL-E ë˜ëŠ” ì™¸ë¶€ ë””ìì¸ API(ì˜ˆ: Canva API)ë¥¼ í™œìš©í•˜ì—¬ ì‹œê° ìë£Œë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ë„ë¡ í™•ì¥ë  ì˜ˆì •ì…ë‹ˆë‹¤.")

    st.subheader("ì˜ˆìƒ ê¸°ëŠ¥ êµ¬ì„±")

    st.markdown("""

    * **í…œí”Œë¦¿ ê¸°ë°˜ ë°°ë„ˆ ìë™ ìƒì„±:** ì†Œìƒê³µì¸ì´ ì—…ë¡œë“œí•œ ì‚¬ì§„ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì¸ìŠ¤íƒ€ê·¸ë¨ ì‚¬ì´ì¦ˆì˜ í—¬ìŠ¤ì¼€ì–´ í…œí”Œë¦¿ì— ìë™ ì ìš©.

    * **í…ìŠ¤íŠ¸ â†’ ì´ë¯¸ì§€ ë³€í™˜:** ì…ë ¥ëœ ë¬¸êµ¬ë¥¼ ì‹œê°í™”í•˜ëŠ” ì¸í¬ê·¸ë˜í”½/ì•„ì´ì½˜ ì´ë¯¸ì§€ ìƒì„±.

    * **ë©”ë‰´íŒ/ê°€ê²©í‘œ ë””ìì¸:** ì…ë ¥ëœ ê°€ê²© ì •ë³´ë¡œ ê¹”ë”í•˜ê³  ì „ë¬¸ì ì¸ ë””ìì¸ì˜ ê°€ê²©í‘œ ì´ë¯¸ì§€ ìƒì„±.

    """)
